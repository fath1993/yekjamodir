{% extends 'base.html' %}
{% load static %}
{% load gallery_custom_tag %}

{% block extra_css %}
    <!-- Select2 -->
    <link rel="stylesheet" href="{% static 'admin-panel/vendors/select2/css/select2.min.css' %}" type="text/css">
    <!-- Clockpicker -->
    <link rel="stylesheet" href="{% static 'admin-panel/vendors/clockpicker/bootstrap-clockpicker.min.css' %}"
          type="text/css">

    <!-- Datepicker -->
    <link rel="stylesheet" href="{% static 'admin-panel/vendors/datepicker-jalali/bootstrap-datepicker.min.css' %}">
    <link rel="stylesheet" href="{% static 'admin-panel/vendors/datepicker/daterangepicker.css' %}">
    <!-- Tagsinput -->
    <link rel="stylesheet" href="{% static 'admin-panel/vendors/tagsinput/bootstrap-tagsinput.css' %}" type="text/css">
    <!-- Tinymac -->
    <script src="{% static 'tinymce_6.5.1/tinymce/js/tinymce/tinymce.min.js' %}" referrerpolicy="origin"></script>
    <script src="{% static 'tinymce_6.5.1/custom/init-func.js' %}"></script>
    <style>
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
{% endblock %}

{% block content %}
    <main class="main-content">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-12 mb-3">
                                <h4 class="card-title text-primary">ایجاد متا جدید</h4>
                                <form id="metapost-new-form" action="{% url 'auto_robots:metapost-new' %}" method="post"
                                      enctype="multipart/form-data">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <label for="publish_with_bots">انتشار توسط ربات های</label>
                                        <select class="js-example-basic-single" id="publish_with_bots"
                                                name="publish_with_bots" multiple>
                                            {% if publish_with_bots %}
                                                {% for bot in bots %}
                                                    {% for publish_with_bot in publish_with_bots %}
                                                        {% if publish_with_bot == bot.id|stringformat:"s" %}
                                                            <option selected
                                                                    value="{{ bot.id }}">{{ bot.bot_name }}</option>
                                                        {% else %}
                                                            <option value="{{ bot.id }}">{{ bot.bot_name }}</option>
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endfor %}
                                            {% else %}
                                                {% for bot in bots %}
                                                    <option value="{{ bot.id }}">{{ bot.bot_name }}</option>
                                                {% endfor %}
                                            {% endif %}
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="message_action_situation">زمان ارسال</label>
                                        <select class="js-example-basic-single" id="message_action_situation"
                                                name="message_action_situation"
                                                onchange="time_section_changer(this)">
                                            <option selected value="just_in_time">در لحظه</option>
                                            <option value="add_to_queue">زمان بندی شده</option>
                                        </select>
                                        <script>
                                            function time_section_changer(content) {
                                                if (content.value === 'just_in_time') {
                                                    document.getElementById('timing_section').hidden = true
                                                    document.getElementById('event_remind_me_at_once_section').hidden = true
                                                    document.getElementById('event_remind_me_at_once').checked = false

                                                    document.getElementById('event_hourly_remind_me_at_number_section').hidden = true
                                                    document.getElementById('event_hourly_remind_me_at').checked = false

                                                    document.getElementById('event_daily_remind_me_at_section').hidden = true
                                                    document.getElementById('event_daily_remind_me_at').checked = false

                                                    document.getElementById('event_monthly_remind_me_at_section').hidden = true
                                                    document.getElementById('event_monthly_remind_me_at').checked = false

                                                    document.getElementById('event_yearly_remind_me_at_section').hidden = true
                                                    document.getElementById('event_yearly_remind_me_at').checked = false
                                                } else {
                                                    document.getElementById('timing_section').hidden = false
                                                }
                                            }
                                        </script>
                                    </div>
                                    <div class="form-group" id="timing_section" hidden>
                                        <div class="row">
                                            <div class="col-sm-4 col-md-3 col-lg-2">
                                                <div class="form-group form-check">
                                                    <input type="checkbox" class="form-check-input"
                                                           id="event_remind_me_at_once" name="event_remind_me_at_once"
                                                           onchange="change_visibility(this, 'event_remind_me_at_once_section')">
                                                    <label class="form-check-label" for="event_remind_me_at_once">ارسال
                                                        یکباره</label>
                                                </div>
                                            </div>
                                            <div class="col-sm-4 col-md-3 col-lg-2">
                                                <div class="form-group form-check">
                                                    <input type="checkbox" class="form-check-input"
                                                           id="event_hourly_remind_me_at"
                                                           name="event_hourly_remind_me_at"
                                                           onchange="change_visibility(this, 'event_hourly_remind_me_at_number_section')">
                                                    <label class="form-check-label" for="event_hourly_remind_me_at">ارسال
                                                        هر ساعت</label>
                                                </div>
                                            </div>
                                            <div class="col-sm-4 col-md-3 col-lg-2">
                                                <div class="form-group form-check">
                                                    <input type="checkbox" class="form-check-input"
                                                           id="event_daily_remind_me_at" name="event_daily_remind_me_at"
                                                           onchange="change_visibility(this, 'event_daily_remind_me_at_section')">
                                                    <label class="form-check-label" for="event_daily_remind_me_at">ارسال
                                                        هر روز</label>
                                                </div>
                                            </div>
                                            <div class="col-sm-4 col-md-3 col-lg-2">
                                                <div class="form-group form-check">
                                                    <input type="checkbox" class="form-check-input"
                                                           id="event_monthly_remind_me_at"
                                                           name="event_monthly_remind_me_at"
                                                           onchange="change_visibility(this, 'event_monthly_remind_me_at_section')">
                                                    <label class="form-check-label" for="event_monthly_remind_me_at">ارسال
                                                        هر ماه</label>
                                                </div>
                                            </div>
                                            <div class="col-sm-4 col-md-3 col-lg-2">
                                                <div class="form-group form-check">
                                                    <input type="checkbox" class="form-check-input"
                                                           id="event_yearly_remind_me_at"
                                                           name="event_yearly_remind_me_at"
                                                           onchange="change_visibility(this, 'event_yearly_remind_me_at_section')">
                                                    <label class="form-check-label" for="event_yearly_remind_me_at">ارسال
                                                        هر سال</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group row mb-3"
                                         id="event_remind_me_at_once_section" hidden>
                                        <div class="col-sm-5">
                                            <input type="text" name="event_remind_me_at_once_date"
                                                   id="event_remind_me_at_once_date"
                                                   class="form-control text-left date-picker-shamsi" dir="ltr"
                                                   placeholder="تاریخ">
                                        </div>
                                        <div class="col-sm-5">
                                            <input id="event_remind_me_at_once_time" name="event_remind_me_at_once_time"
                                                   type="text" class="form-control  create-event-demo"
                                                   placeholder="ساعت">
                                        </div>
                                    </div>

                                    <div class="form-group mb-2" id="event_hourly_remind_me_at_number_section" hidden>
                                        <div class="col-sm-12">
                                            <input type="number" min="0" max="59" class="form-control text-left"
                                                   id="event_hourly_remind_me_at_number"
                                                   name="event_hourly_remind_me_at_number" placeholder="دقیقه"
                                                   dir="ltr">
                                        </div>
                                    </div>

                                    <div class="form-group mb-2" id="event_daily_remind_me_at_section" hidden>
                                        <div class="col-sm-12">
                                            <input id="event_daily_remind_me_at_time"
                                                   name="event_daily_remind_me_at_time" type="text"
                                                   class="form-control create-event-demo" placeholder="ساعت">
                                        </div>
                                    </div>

                                    <div class="form-group row justify-content-center mb-3"
                                         id="event_monthly_remind_me_at_section" hidden>
                                        <div class="col-sm-5">
                                            <input type="number" min="0" max="59" class="form-control text-left"
                                                   id="event_monthly_remind_me_at_day"
                                                   name="event_monthly_remind_me_at_day" placeholder="روز" dir="ltr">
                                        </div>
                                        <div class="col-sm-5">
                                            <input id="event_monthly_remind_me_at_time"
                                                   name="event_monthly_remind_me_at_time" type="text"
                                                   class="form-control  create-event-demo" placeholder="ساعت">
                                        </div>
                                    </div>

                                    <div class="form-group row justify-content-center mb-3"
                                         id="event_yearly_remind_me_at_section" hidden>
                                        <div class="col-sm-3">
                                            <input type="number" min="0" max="59" class="form-control text-left"
                                                   id="event_yearly_remind_me_at_month"
                                                   name="event_yearly_remind_me_at_month" placeholder="ماه" dir="ltr">
                                        </div>
                                        <div class="col-sm-3">
                                            <input type="number" min="0" max="59" class="form-control text-left"
                                                   id="event_yearly_remind_me_at_day"
                                                   name="event_yearly_remind_me_at_day" placeholder="روز" dir="ltr">
                                        </div>
                                        <div class="col-sm-3">
                                            <input id="event_yearly_remind_me_at_time"
                                                   name="event_yearly_remind_me_at_time" type="text"
                                                   class="form-control  create-event-demo" placeholder="ساعت">
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="form-group">
                                        <label for="metapost_title">عنوان</label>
                                        <input type="text" class="form-control text-left" id="metapost_title"
                                               name="metapost_title"
                                               aria-describedby="metapost_title" placeholder="" dir="rtl"
                                               required
                                               oninvalid="this.setCustomValidity('پر کردن این بخش ضروری است')"
                                               oninput="setCustomValidity('')"
                                               value="{{ metapost_title }}">
                                    </div>
                                    <div class="form-group">
                                        <label for="metapost_sub_title">زیر عنوان</label>
                                        <input type="text" class="form-control text-left" id="metapost_sub_title"
                                               name="metapost_sub_title"
                                               aria-describedby="metapost_sub_title" placeholder="" dir="rtl"
                                               value="{{ metapost_sub_title|default:'' }}">
                                    </div>
                                    <div class="form-group">
                                        <label for="metapost_categories">دسته ها</label>
                                        <input type="text" id="metapost_categories" name="metapost_categories"
                                               class="form-control tagsinput"
                                               placeholder="دسته ها" value="{{ metapost_categories|default:'' }}">
                                    </div>
                                    <div class="form-group">
                                        <label for="metapost_keywords">کلمات کلیدی</label>
                                        <input type="text" id="metapost_keywords" name="metapost_keywords"
                                               class="form-control tagsinput"
                                               placeholder="کلمات کلیدی" value="{{ metapost_keywords|default:'' }}">
                                    </div>
                                    <div class="form-group">
                                        <label for="metapost_attached_file_link">فایل ضمیمه</label>
                                        <div class="row justify-content-center">
                                            <div class="col-sm-12 col-md-2 col-lg-2">
                                                <button type="button" class="btn btn-primary text-center"
                                                        data-toggle="modal" data-target="#addNewFileModal"><i
                                                        class="fa fa-plus-circle mr-2"></i> آپلود فایل
                                                </button>
                                                <div id="addNewFileModal" class="modal fade" tabindex="-1" role="dialog"
                                                     aria-hidden="true">
                                                    <div class="modal-dialog" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="gridModalLabel">بارگذاری
                                                                    فایل</h5>
                                                                <button type="button" class="close" data-dismiss="modal"
                                                                        aria-label="بستن">
                                                                    <i class="ti-close"></i>
                                                                </button>
                                                            </div>
                                                            <div id="inner_upload_file_form">
                                                                <div class="modal-body">
                                                                    <div class="container-fluid bd-example-row">
                                                                        <div class="form-group">
                                                                            <label for="file_alt">نام</label>
                                                                            <input type="text"
                                                                                   class="form-control text-left"
                                                                                   id="file_alt"
                                                                                   name="file_alt"
                                                                                   aria-describedby="file_alt"
                                                                                   placeholder="" dir="rtl"
                                                                                   oninvalid="this.setCustomValidity('پر کردن این بخش ضروری است')"
                                                                                   oninput="setCustomValidity('')">
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label for="file">فایل ضمیمه</label>
                                                                            <input type="file"
                                                                                   onchange="upload_file_btn_refresh(); check_file_is_image()"
                                                                                   class="form-control-file" id="file"
                                                                                   name="file">
                                                                        </div>
                                                                        <div id="image-compressor-checkbox"
                                                                             class="form-group form-check"
                                                                             disabled="true" hidden>
                                                                            <input type="checkbox"
                                                                                   class="form-check-input"
                                                                                   id="imageCompressor"
                                                                                   onchange="image_compressor(this)">
                                                                            <label class="form-check-label"
                                                                                   for="imageCompressor">فشرده سازی
                                                                                تصویر</label>
                                                                        </div>
                                                                        <div id="image-compress-size" class="form-group"
                                                                             disabled="true" hidden>
                                                                            <label for="image_compress_size">فشرده سازی
                                                                                تا</label>
                                                                            <input type="number"
                                                                                   class="form-control text-left"
                                                                                   id="image_compress_size"
                                                                                   name="image_compress_size"
                                                                                   placeholder="کیلوبایت" dir="ltr">
                                                                        </div>
                                                                        <div class="form-group" hidden>
                                                                            <span id="upload-file-alert"
                                                                                  class="form-control-plaintext text-danger"></span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <a href="{% url 'file-gallery:files-list' %}"
                                                                       type="button" class="btn btn-success"
                                                                    >مدیر فایل
                                                                    </a>
                                                                    <button type="button" class="btn btn-secondary"
                                                                            data-dismiss="modal"
                                                                            id="inner_upload_file_form_close_btn">بستن
                                                                    </button>
                                                                    <button id="upload-file-btn" type="button"
                                                                            class="btn btn-primary"
                                                                            onclick="uploadPermission()">تایید
                                                                    </button>
                                                                </div>
                                                            </div>
                                                            <script>
                                                                function isImage(file) {
                                                                    return file.type.startsWith('image');
                                                                }

                                                                function check_file_is_image() {
                                                                    const fileInput = document.getElementById('file'); // Assuming you have a file input element
                                                                    const file = fileInput.files[0]; // Get the first file (assuming it's the one you want to check)

                                                                    if (isImage(file)) {
                                                                        const image_compressor_checkbox = document.getElementById('image-compressor-checkbox')
                                                                        const image_compressor = document.getElementById('imageCompressor')
                                                                        image_compressor_checkbox.hidden=false
                                                                        {% if not request.user.profile_user|check_user_is_vip %}
                                                                            image_compressor.setAttribute('disabled', 'true')
                                                                            image_compressor.setAttribute('readonly', 'true')
                                                                            if (document.getElementById('upgrade-plan') === null) {
                                                                                image_compressor_checkbox.innerHTML += `
                                                                                <a id="upgrade-plan" href="javascript:void(0)" target="_blank"><span class="form-control-plaintext text-info">کاربر ویژه نیستید؟ ارتقا دهید!</span></a>
                                                                                `
                                                                            }
                                                                        {% endif %}
                                                                    } else {
                                                                        document.getElementById('imageCompressor').checked = false
                                                                        document.getElementById('image-compressor-checkbox').hidden = true
                                                                        document.getElementById('image-compressor-checkbox').setAttribute('disabled', 'true')
                                                                        document.getElementById('image-compress-size').hidden = true
                                                                        document.getElementById('image-compress-size').setAttribute('disabled', 'true')
                                                                    }
                                                                }

                                                                function image_compressor(check_box) {
                                                                    console.log(this)
                                                                    if (check_box.checked) {
                                                                        document.getElementById('image-compress-size').hidden = false
                                                                        document.getElementById('image-compress-size').setAttribute('disabled', 'false')
                                                                    } else {
                                                                        document.getElementById('image-compress-size').hidden = true
                                                                        document.getElementById('image-compress-size').setAttribute('disabled', 'true')
                                                                    }
                                                                }

                                                                function remove_file(file_id) {
                                                                    document.getElementById('file-col-' + file_id).hidden = true
                                                                    $.ajax({
                                                                        type: "post",
                                                                        url: "{% url 'file-gallery:ajax-file-remove' %}",
                                                                        data: {
                                                                            csrfmiddlewaretoken: '{{ csrf_token }}',
                                                                            file_id: file_id,
                                                                        },
                                                                        success: function (response) {
                                                                            document.getElementById('file-col-' + file_id).remove()
                                                                            toastr.success('با موفقیت انجام شد');
                                                                            user_storage_analyzer()
                                                                        },
                                                                        error: function (xhr, errmsg, err) {
                                                                            toastr.error('خطایی رخ داد');
                                                                        }
                                                                    });
                                                                }

                                                                function upload_file_btn_refresh() {
                                                                    const upload_file_btn = document.getElementById('upload-file-btn')
                                                                    const upload_file_btn_parent = upload_file_btn.parentElement
                                                                    upload_file_btn.remove()
                                                                    upload_file_btn_parent.innerHTML += `
                                                                    <button id="upload-file-btn" type="button" class="btn btn-primary" onclick="uploadPermission()">تایید</button>
                                                                    `
                                                                    const upload_file_alert = document.getElementById('upload-file-alert')
                                                                    upload_file_alert.innerText = ''
                                                                    upload_file_alert.parentElement.hidden = true
                                                                }

                                                                function startSpinner() {
                                                                    const upload_file_btn = document.getElementById('upload-file-btn')
                                                                    const upload_file_btn_parent = upload_file_btn.parentElement
                                                                    upload_file_btn.remove()
                                                                    upload_file_btn_parent.innerHTML += `
                                                                    <button id="upload-file-btn" class="btn btn-primary" type="button" disabled>
                                                                        <span class="spinner-border spinner-border-sm m-r-5" role="status" aria-hidden="true"></span>
                                                                                در حال بررسی ...
                                                                    </button>
                                                                    `


                                                                }

                                                                function stopSpinnerAndUploadFile() {
                                                                    const upload_file_btn = document.getElementById('upload-file-btn')
                                                                    const upload_file_btn_parent = upload_file_btn.parentElement
                                                                    upload_file_btn.remove()
                                                                    upload_file_btn_parent.innerHTML += `
                                                                    <button id="upload-file-btn" type="button" class="btn btn-primary" onclick="uploadFiles()">تایید</button>
                                                                    `
                                                                }

                                                                function stopSpinnerAndPromotePlan() {
                                                                    const upload_file_btn = document.getElementById('upload-file-btn')
                                                                    const upload_file_btn_parent = upload_file_btn.parentElement
                                                                    upload_file_btn.remove()
                                                                    upload_file_btn_parent.innerHTML += `
                                                                    <button id="upload-file-btn" type="button" class="btn btn-primary" onclick="{% url 'dashboard:dashboard' %}">خرید اشتراک ویژه</button>
                                                                    `
                                                                }

                                                                function uploadPermission() {
                                                                    const upload_file_alert = document.getElementById('upload-file-alert')
                                                                    const textValue = document.getElementById('file_alt').value;
                                                                    const fileValue = document.getElementById('file').files;
                                                                    if (textValue.trim() !== '' && fileValue.length > 0) {
                                                                        const file = fileValue[0]
                                                                        const fileSize = file.size;
                                                                        const formData = new FormData();
                                                                        formData.append('fileSize', fileSize);
                                                                        formData.append('csrfmiddlewaretoken', '{{ csrf_token }}')

                                                                        startSpinner()

                                                                        fetch('{% url 'file-gallery:upload-permission' %}', {
                                                                            method: 'POST',
                                                                            body: formData
                                                                        })
                                                                            .then(response => response.json())
                                                                            .then(data => {
                                                                                if (data['message'] !== 'allowed') {
                                                                                    stopSpinnerAndPromotePlan()
                                                                                    upload_file_alert.innerText = data['message']
                                                                                    upload_file_alert.parentElement.hidden = false
                                                                                } else {
                                                                                    uploadFiles()
                                                                                }

                                                                            })
                                                                            .catch(error => {
                                                                                console.error('Error:', error);
                                                                                upload_file_btn_refresh()
                                                                                upload_file_alert.innerText = error
                                                                                upload_file_alert.parentElement.hidden = false
                                                                            });
                                                                    } else {
                                                                        if (textValue.trim() === '') {
                                                                            upload_file_alert.innerText = 'نام وارد نشده است'
                                                                            upload_file_alert.parentElement.hidden = false
                                                                        } else if (fileValue.length === 0) {
                                                                            upload_file_alert.innerText = 'فایل وارد نشده است'
                                                                            upload_file_alert.parentElement.hidden = false
                                                                        }

                                                                    }

                                                                }

                                                                function uploadFiles() {
                                                                    const upload_file_alert = document.getElementById('upload-file-alert')
                                                                    const file_alt = document.getElementById('file_alt')
                                                                    const file = document.getElementById('file')
                                                                    const image_compress_size = document.getElementById('image_compress_size')

                                                                    if (file_alt.value === '') {
                                                                        upload_file_alert.innerText = 'نام فایل را وارد نمایید'
                                                                        upload_file_alert.parentElement.hidden = false
                                                                    } else if (file.files.length === 0) {
                                                                        upload_file_alert.innerText = 'فایل نمیتواند خالی باشد'
                                                                        upload_file_alert.parentElement.hidden = false
                                                                    } else {
                                                                        upload_file_alert.innerText = ''
                                                                        upload_file_alert.parentElement.hidden = true
                                                                        const formData = new FormData();
                                                                        formData.append('file_alt', file_alt.value);
                                                                        formData.append('file', file.files[0])
                                                                        formData.append('image_compress_size', image_compress_size.value);
                                                                        formData.append('csrfmiddlewaretoken', '{{ csrf_token }}')

                                                                        fetch('{% url 'file-gallery:upload-files' %}', {
                                                                            method: 'POST',
                                                                            body: formData
                                                                        })
                                                                            .then(response => response.json())
                                                                            .then(data => {
                                                                                upload_file_btn_refresh()
                                                                                if (data['message'] === 'succeed') {
                                                                                    upload_file_alert.innerText = ''
                                                                                    upload_file_alert.parentElement.hidden = true
                                                                                    file.value = ''
                                                                                    file_alt.value = ''
                                                                                    document.getElementById('image-compressor-checkbox').hidden=true
                                                                                    document.getElementById('image_compress_size').value=''
                                                                                    document.getElementById('image-compress-size').hidden=true
                                                                                    try {
                                                                                        document.getElementById('upgrade-plan').remove()
                                                                                    } catch (err) {}
                                                                                    document.getElementById('inner_upload_file_form_close_btn').click()
                                                                                    document.getElementById('metapost_attached_file_link').value = data['file_url']
                                                                                } else {
                                                                                    upload_file_alert.innerText = data['message']
                                                                                    upload_file_alert.parentElement.hidden = false
                                                                                }
                                                                            })
                                                                            .catch(error => {
                                                                                upload_file_btn_refresh()
                                                                                upload_file_alert.innerText = error
                                                                                upload_file_alert.parentElement.hidden = false
                                                                            });
                                                                    }
                                                                }
                                                            </script>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-12 col-md-10 col-lg-10">
                                                <input type="text" class="form-control text-right"
                                                       id="metapost_attached_file_link"
                                                       name="metapost_attached_file_link"
                                                       aria-describedby="metapost_attached_file_link"
                                                       placeholder="https://yourfile.com" dir="ltr">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="full-featured">محتوا</label>
                                        <textarea id="full-featured" name="metapost_content"
                                                  dir="rtl">{{ metapost_content|default:'' }} </textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="metapost_view_type">نحوه ارسال</label>
                                        <select class="js-example-basic-single" id="metapost_view_type"
                                                name="metapost_view_type">
                                            <option selected value="simple_text">متن ساده</option>
                                            <option value="photo">عکس + کپشن</option>
                                            <option value="video">ویدئو + کپشن</option>
                                            <option value="audio">صوت + کپشن</option>
                                            <option value="document">فایل + کپشن</option>
                                        </select>
                                    </div>
                                    {% if alert %}
                                        <div class="form-group">
                                            <span class="text text-danger">{{ alert }}</span>
                                        </div>
                                    {% endif %}
                                    <button type="submit" class="btn btn-primary">ایجاد</button>
                                    <a href="{% url 'auto_robots:metapost-list-with-bot-id' auto_robot_id=0 %}"
                                       class="btn btn-primary">بازگشت</a>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>
{% endblock %}

{% block extra_js %}
    <!-- Datepicker -->
    <script src="{% static 'admin-panel/vendors/datepicker-jalali/bootstrap-datepicker.min.js' %}"></script>
    <script src="{% static 'admin-panel/vendors/datepicker-jalali/bootstrap-datepicker.fa.min.js' %}"></script>
    <script src="{% static 'admin-panel/vendors/datepicker/daterangepicker.js' %}"></script>
    <script>
        $('.date-picker-shamsi').datepicker({
            dateFormat: "yy/mm/dd",
            showOtherMonths: true,
            selectOtherMonths: false

        });
    </script>
    <script src="{% static 'admin-panel/vendors/clockpicker/bootstrap-clockpicker.min.js' %}"></script>
    <script src="{% static 'admin-panel/assets/js/examples/clockpicker.js' %}"></script>

    <!-- Select2 -->
    <script src="{% static 'admin-panel/vendors/select2/js/select2.min.js' %}"></script>
    <script src="{% static 'admin-panel/assets/js/examples/select2.js' %}"></script>
    <!-- Tagsinput -->
    <script src="{% static 'admin-panel/vendors/tagsinput/bootstrap-tagsinput.js' %}"></script>
    <script src="{% static 'admin-panel/assets/js/examples/tagsinput.js' %}"></script>
    <script>
        {% if alert %}
            'use strict';
            $(document).ready(function () {
                toastr.options = {
                    timeOut: 3000,
                    progressBar: true,
                    showMethod: "slideDown",
                    hideMethod: "slideUp",
                    showDuration: 200,
                    hideDuration: 200
                };
                toastr.error('{{ alert }}');
            });
        {% endif %}
        function toggleVisibility(select) {
            var selectedValue = select.value;
            var input1 = document.getElementById('date-of-action-block');

            input1.hidden = selectedValue === 'just_in_time';
        }

        var promotion_cleaner = setInterval(() => {
            var promotions = document.getElementsByClassName('tox-promotion')
            if (promotions.length > 0) {
                for (var i = 0; i <= promotions.length; i++) {
                    try {
                        promotions[i].hidden = true
                    } catch {
                    }
                }
                clearInterval(promotion_cleaner);
            }

        }, 1000);
    </script>
    <script>
        function change_visibility(checkbox, item_visibility_change_id) {
            document.getElementById(item_visibility_change_id).hidden = !checkbox.checked;
        }
    </script>
{% endblock %}